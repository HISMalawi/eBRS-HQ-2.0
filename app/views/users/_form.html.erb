
  <br />
  <br />

<%if request.path.match(/new/) 
  url_str = '/create_user'
else
  url_str = '/users/edit'
end%>

<%= form_for(@user, as: :post, url: url_str, method: 'post') do |f| %>
  <div class="form-group">
    <label for="username">Username:</label>
    <%= f.text_field :username,
      :class => "input_cell",
      :placeholder => "Username",
      :required => true,
      :class => 'form-control',
      :textCase => "lower", 
      :uniq_check => "/username_availability?search_str=" %>
  </div>

  <%= f.fields_for :person_name do |i| %>
  <div class="form-group">
    <label for="first_name">First name:</label>
    <%= i.text_field :first_name,
      :class => "input_cell form-control", 
      :placeholder => "First name",
      :required => true,
      :value => (@user.core_person.person_name.first_name rescue nil),
      :class => 'form-control'%>
  </div>

  <div class="form-group">
    <label for="first_name">Last name:</label>
    <%= i.text_field :last_name,
      :class => "input_cell form-control", 
      :placeholder => "Last name",
      :required => true,
      :value => (@user.core_person.person_name.last_name rescue nil),
      :class => 'form-control'%>
  </div>
  <%end%>

    <div class="form-group">
    <label for="role">Gender:</label><br />
    <%= f.fields_for :person do |i| %>
    <% @roles = ['','Female','Male']%>

    <%= i.select :gender, options_for_select(@roles),
        :class => "input_cell form-control", 
        :placeholder => "Gender",
        :required => true %>
    <% end %> 
    </div>

    <div class="form-group">
    <label for="role">Select role:</label><br />
    <%= f.fields_for :user_role do |i| %>
    <% @roles = ['']
      Role.all.map do |r|
        @roles << r.role 
      end%>

    <%= i.select :role, options_for_select(@roles),
        :class => "input_cell form-control", 
        :placeholder => "Select Role",
        :required => true %>
    <% end %> 
    </div>

  <div class="form-group">
    <label for="pwd">Password:</label>
    <%= f.password_field :password,
        :class => "input_cell form-control", 
        :placeholder => "Password",
        :required => true, 
        :textCase => "lower" %>
  </div>

  <div class="form-group">
    <label for="pwd">Confirm password:</label>
    <%= f.password_field :confirm_password,
        :class => "input_cell form-control", 
        :placeholder => "Confirm password",
        :required => true, 
        :textCase => "lower" %>
  </div>

  <br />
  <br />
  <br />

  <button type="submit" class="btn btn-warning btn-lg">
    <i class="fa fa-floppy-o"></i>&nbsp;Save</button>

  <a href="javascript:location='/users'" 
    class="btn btn-primary btn-lg"><i class="fa fa-chevron-circle-left"></i>&nbsp;Back</a>

  <input type='hidden' value="<%= params[:user_id]%>" name="user_id" />
<% end %>
