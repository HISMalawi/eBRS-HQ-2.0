<!DOCTYPE HTML>
<html>
<head>
  <title>eBRS Birth Certificate</title>
  <style>

      body {
          margin: 10px;
          -moz-user-select: none;
          font-family: "Nimbus Sans L", "Arial Narrow", sans-serif;
          margin: auto;
          color: #3465a4;
          font-size: 18px;
      }

  </style>

  <% if @data.length > 1%>
    <style>
      .tbl{
          border-bottom: 2px solid gray;
      }
    </style>
  <% end %>
</head>
<body style="color: #000;">

<% @data.each do |data|
 person = data['person']
 birth = data['birth']

%>
<table class="tbl" style="width: 21cm;" cellpadding="5">
<tr>
  <th style="font-size: 18px; font-weight: normal;">
    &nbsp;
  </th>
</tr>
<tr>
  <th style="font-size: 18px; font-weight: normal;">
    &nbsp;
  </th>
</tr>
<tr>
  <td style="width: 230px; vertical-align: top;">
    <div style="padding: 10px; border: 1px solid #000; width: 120px; text-align: center; margin: 15px; margin-left: 80px;">
      Form NR9
    </div>
  </td>
  <td align="center" style="padding-right: 10px;">
    <img src="<%= emblem %>" height="80"/>
  </td>

  
  <td align="right" style="width: 250px; vertical-align: top;">
    <% raw = File.read("#{SETTINGS['barcodes_path']}#{person.id}.png")

       dt = Base64.encode64(raw)
    %>
    <img src ="data:image/png;base64,<%= dt%>" />
    <br/>
    <div style="text-align: center !important;margin-top: -15px;font-size: 12px;"><%= person.npid rescue nil %></div>

  </td>
  
 
</tr>
<tr>
  <th colspan="3" style="font-size: 20px;">
    REPUBLIC OF MALAWI
  </th>
</tr>
<tr>
  <th colspan="3" style="font-size: 22px; font-weight: normal;">
    NATIONAL REGISTRATION ACT, 2010
  </th>
</tr>
<tr>
  <th colspan="3" style="font-size: 20px;">
    CERTIFICATE OF BIRTH
  </th>
</tr>
<tr>
  <th colspan="3" style="font-size: 18px; font-weight: normal;">
    (Regulation 26)
  </th>
</tr>
<tr>
  <th colspan="3" style="font-size: 18px; font-weight: normal;">
    &nbsp;
  </th>
</tr>
<tr>
  <th colspan="3" style="font-size: 18px; font-weight: normal;">

    <table width="100%" cellpadding="10">
      <tr>
        <td style="width: 130px;" align="right">
          1.
        </td>
        <td align="left" style="width: 300px;">
          Birth Entry Number
        </td>
        <td align="left">
          <%= birth.ben rescue nil %>
        </td>
      </tr>
      <tr>
        <td style="width: 130px;" align="right">
          2.
        </td>
        <td align="left" style="width: 300px;">
          Registration Number
        </td>
        <td align="left">
          <%= birth.brn.blank? ? "00000000000" : birth.brn%>
        </td>
      </tr>
      <tr>
        <td style="width: 130px;" align="right">
          3.
        </td>
        <td align="left" style="width: 300px;">
          Name
        </td>
        <td align="left">
          <%= person.printable_name %>
        </td>
      </tr>
      <tr>
        <td style="width: 130px;" align="right">
          4.
        </td>
        <td align="left" style="width: 300px;">
          Date of Birth
        </td>
        <td align="left">
          <%= person.birthdate.to_date.strftime("%d/%b/%Y")%>
        </td>
      </tr>
      <tr>
        <td style="width: 130px;" align="right">
          5.
        </td>
        <td align="left" style="width: 300px;">
          Sex
        </td>
        <td align="left">
          <%= person.full_gender rescue nil %>
        </td>
      </tr>

      <%
        birth_place = birth.birth_place.name
        if birth.district_of_birth.present?
          birth_district = Location.find(birth.district_of_birth).name rescue nil 
          if birth_district.present?
             place_of_birth = Location.find(birth.birth_location_id).name rescue birth.other_place_of_birth
             place_of_birth += ", " + birth_district 
          else
             place_of_birth = Location.find(birth.birth_location_id).name rescue birth.other_place_of_birth
          end
        else
          place_of_birth = Location.find(birth.birth_location_id).name rescue birth.other_place_of_birth
        end
      %>

      <tr>
        <td style="width: 130px;" align="right">
          6.
        </td>
        <td align="left" style="width: 300px;">
          Place of Birth
        </td>
        <td align="left">
          <%= place_of_birth %>
        </td>
      </tr>
      <tr>
        <td style="width: 130px;" align="right">
          7.
        </td>
        <td align="left" style="width: 300px;">
          Name of Mother
        </td>
        <td align="left">
           
          <%= person.mother.printable_name rescue nil%>
          
        </td>
      </tr>
      <tr>
        <td style="width: 130px;" align="right">
          8.
        </td>
        <td align="left" style="width: 300px;">
          Nationality of Mother
        </td>
        <td align="left">
               <%= person.mother.citizenship rescue nil %>
        </td>
      </tr>
                 
      <% if birth.parents_married_to_each_other.to_s == '0' %>
              <tr>
							<% if birth.court_order_attached.to_s == '1' || birth.parents_signed.to_s == '1'  %>
								 <% if (person.father.name.present? rescue false)%>
									<td style="width: 130px;" align="right">
									9.
									</td>
									<td align="left" style="width: 300px;">
									Name of Father
									</td>
									<td align="left">
										<%= person.father.printable_name %>
									</td>
									</tr>
									
									<tr>
											<td style="width: 130px;" align="right">
											10.
											</td>
											<td align="left" style="width: 300px;">
											Nationality of Father
											</td>
											<td align="left">
											 	<%= person.father.citizenship rescue nil %>
											</td>
			       			</tr>
								 <% end %>
			        <% end %>
			       
	    <% else %>
	         <tr>
	         <td style="width: 130px;" align="right">
                                9.
                            </td>
                            <td align="left" style="width: 300px;">
                                Name of Father
                            </td>
                            <td align="left">
                                <% if (person.father.name.present? rescue false) %>
                                    <%= person.father.printable_name  %>
                                <% end %>
	           </td>
	         </tr>
	         
 	         <tr>
									<td style="width: 130px;" align="right">
									10.
									</td>
									<td align="left" style="width: 300px;">
									Nationality of Father
									</td>
									<td align="left">
									 	<%= person.father.citizenship rescue nil %>
									</td>
								 
			       </tr>
	           
	    <% end %> 
       
      <tr>
      
    <% if birth.parents_married_to_each_other.to_s == '0' %>
		  <% if birth.court_order_attached.to_s == '1' || birth.parents_signed.to_s == '1'  %>
		          <tr>
							<% if (person.father.name.present? rescue false) %>
							 <td style="width: 130px;" align="right">
								      11.
								   </td>

							<% else %>
								   <td style="width: 130px;" align="right">
								      9.
								   </td>
						  <% end %>
						  
				<td align="left" style="width: 300px;">
          Date of Registration
        </td>
        <td align="left">
          <%= birth.date_registered.to_date.strftime("%d").to_i rescue nil %><sup><%= birth.date_registered.to_date.strftime("%d").to_i.ordinalize.gsub(/\d+/, "") rescue nil
        %></sup> <%= birth.date_registered.to_date.strftime("%B") rescue nil %>, <%= birth.date_registered.to_date.strftime("%Y") rescue nil %>
        </td>
      </tr>
						  
						  
      <% else %>
              <td style="width: 130px;" align="right">
                 9.
              </td>
              <td align="left" style="width: 300px;">
          Date of Registration
        </td>
        <td align="left">
          <%= birth.date_registered.to_date.strftime("%d").to_i rescue nil %><sup><%= birth.date_registered.to_date.strftime("%d").to_i.ordinalize.gsub(/\d+/, "") rescue nil
        %></sup> <%= birth.date_registered.to_date.strftime("%B") rescue nil %>, <%= birth.date_registered.to_date.strftime("%Y") rescue nil %>
        </td>
      </tr>
      
      <tr>
        <th colspan="3" style="font-size: 18px; font-weight: normal;">
          &nbsp;
        </th>
      </tr>
      <tr>
        <th colspan="3" style="font-size: 18px; font-weight: normal;">
          &nbsp;
        </th>
      </tr>
              
		  <% end %>
    <% else %>
          <td style="width: 130px;" align="right">
              11.
          </td>
          <td align="left" style="width: 300px;">
          Date of Registration
        </td>
        <td align="left">
          <%= birth.date_registered.to_date.strftime("%d").to_i rescue nil %><sup><%= birth.date_registered.to_date.strftime("%d").to_i.ordinalize.gsub(/\d+/, "") rescue nil
        %></sup> <%= birth.date_registered.to_date.strftime("%B") rescue nil %>, <%= birth.date_registered.to_date.strftime("%Y") rescue nil %>
        </td>
      </tr>
    <% end %>
      
      <tr>
        <th colspan="3" style="font-size: 18px; font-weight: normal;">
          I hereby certify the above to be a true and correct extract from the<br/>
          Birth Register kept at NRB.
        </th>
      </tr>
      <tr>
        <td colspan="3" style="font-size: 18px; font-weight: normal;">
          Dated this <%= Date.today.strftime("%d").to_i rescue nil %><sup><%= Date.today.strftime("%d").to_i.ordinalize.gsub(/\d+/, "") rescue nil
        %></sup> <%= Date.today.strftime("%B") rescue nil %>, <%= Date.today.strftime("%Y") rescue nil %>
        </td>
      </tr>
      <tr>
        <td colspan="2" style="font-size: 18px; font-weight: normal;">
          <div style="border: 1px dotted #ccc; width: 180px; height: 100px; margin-left: 80px;">&nbsp;</div>
        </td>
        <td align="right">
          <table style="border: 1px solid #000; margin-right: 0px;" cellpadding="5" cellspacing="10">
            <tr>
              <td style="border-bottom: 1px dotted #000; font-size: 32px; height: 50px;">
               <% raw = File.read(Rails.root.join("public","uploads",@signature)) rescue nil %>
                 
                 <% if raw
                      @sig = Base64.encode64(raw)
                    end %>
                    
                 <% if @sig.present? %>
                 		<img src ="data:image/png;base64,<%= @sig %>" width="120" height="50" />
                 <% end %>
              </td>
            </tr>
            <tr>
              <th>
                <i>Signatures Officer(NRB)</i>
              </th>
            </tr>
          </table>
        </td>
      </tr>
    </table>

  </th>
</tr>
</table>
<% end %>
</body>


    <style>
        .tbl{
            margin: auto;
            background: white;
        }
        .tbl td{
            padding: 5px;
            font-size: 18px !important;
        }
        body {
            background: white;
        }
    </style>


</html>
